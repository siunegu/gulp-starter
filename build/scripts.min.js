function rotateScreen(){var t=document.querySelector(".layout");t.classList.toggle("layout--rotated")}function getProjects(t){var e=[],n=Promise.resolve(getdata(_endpoint).done(function(t){t.data}));return new Promise(function(){n.then(function(t){t.data.forEach(function(t){e.push(getdata(_endpoint+"/"+t.id))})}).then(function(){Promise.all(e).then(function(e){t(e)})})})}function getdata(t){return $.ajax({type:"GET",url:t,contentType:"application/json",dataType:"json",beforeSend:function(t){t.setRequestHeader("Authorization","Basic "+btoa(_api_key+":"))}})}function getDueDate(t){var e=1/((moment(t.due_date)-moment())*(1/(10^1e8)))*1e3*2;if(e&&e>0){var n=750,a=50;return e<a&&console.log("less than min",t.name),e>n&&console.log("bigger than max",t.name),e<a?2*e:.75*e}return 0}function populateData(t){var e="Harry",n='"'+e+'. come on mate."',a=""+e+" of the Aznavoor, First of his name",o=["http://www.stevensegallery.com/600/300","http://www.placecage.com/gif/600/300"];t.forEach(function(t,i,c){var r=$(".box").eq(i),d={daysTilDue:moment(t.due_date).diff(moment(),"days")},l={client:l||n},s={contact:s||e},u={contactTitle:u||a},f={bgImage:f||o[Math.floor(2*Math.random())]};t.notes.split("\n").forEach(function(e,n,a){e.indexOf("client")>-1&&(l.client=e.split("client:")[1].replace(/,/,"")),Object.assign(t,l),e.indexOf("contact")>-1&&(s.contact=e.split("contact:")[1].replace(/,/,"")),Object.assign(t,s),e.indexOf("title")>-1&&(u.contactTitle=e.split("title:")[1].replace(/,/,"")),Object.assign(t,u),e.indexOf("background")>-1&&(f.bgImage=e.split("background:")[1].replace(/,/,"")),Object.assign(t,f)}),Object.assign(t,d),r.find("[data-job-name]").html(t.name),r.find("[data-job-countdown]").html(t.daysTilDue),r.find("[data-job-contact-name]").html(t.contact),r.find("[data-job-contact-department]").html(t.contactTitle),console.log(r.find(".box__image img")),r.find(".box__image img").attr("src",t.bgImage),r.fadeIn()})}function init(){$(".box").hide()}var _endpoint="https://app.asana.com/api/1.0/projects",_api_key="0/21babde74944ce2245756d19855c991d",projects=[];document.addEventListener("click",rotateScreen),init(),getProjects(function(t){var e=t.map(function(t){return t.data}).filter(function(t){if(getDueDate(t)>0)return t}).map(function(t){return t.name.indexOf("_")>0&&(t.name=t.name.split("_").splice(1,t.name.length).join(" ")),t}).sort(function(t,e){return getDueDate(t)<getDueDate(e)});populateData(e)});